---
title: 区块链开发入门
objectives:
- 理解Solana链上程序的工作原理
- 描述链上程序的结构和运行方式
- 构建一个基础程序
---
**译者**: [ben46](https://github.com/ben46)

# 总结

- **链上程序** 是在Solana上运行的程序。
- 程序有一个或多个 **指令处理器**。指令处理器是处理Solana交易中的 **指令** 的函数。
- 指令处理器将它们的数据写入Solana的 **账户**，然后要么成功要么失败。
- Solana程序通常使用 **Rust** 编写，通常使用 **Anchor** 框架。
- Anchor程序具有IDL，它是描述程序的小型JSON文件。IDL可用于自动创建程序的JS/TS库。

# 概述

每个Solana集群（`mainnet-beta`，`testnet`，`devnet`，`localnet`）实际上是一个全局同步状态的单个计算机。在Solana上运行的程序 - 创建代币、交换代币、艺术品交易市场、担保、市场制造商、DePIN应用程序、拍卖、零售支付平台等 - 被称为 **Solana应用程序**。

构建链上应用程序的最流行方式是使用 **Rust** 语言和 **Anchor** 框架。

这些框架自动实现常见的安全检查，并处理常见任务，例如：
- 将传入指令发送到正确的指令处理器
- 从传入交易中解码数据
- 检查传入指令提供的账户，例如，检查某些账户是否属于特定类型，或与其他账户不同。

无论您选择的语言和框架是什么，Solana的工作方式都是相同的。让我们复习一下Solana上的程序是如何工作的。

![显示具有两个指令的交易的图表](../assets/transaction-and-instructions.svg)

## 程序部署在地址上

就像我们可以使用用户的公钥发送代币给用户一样，我们也可以使用程序的公钥找到程序。在使用Anchor时，在`anchor init`期间会创建一个密钥对，并且私钥会保存在项目的`target/deploy`目录中。

程序的公钥有时被称为 '程序ID' 或 '程序地址'。

## 程序有指令处理器

例如，进行交易并在备注中写着“谢谢”的Solana客户端会有两个指令：
  - 一个指令是Token程序的 `transfer` 指令处理器
  - 另一个指令是Memo程序的 `memo` 指令处理器。

这两个指令必须成功完成才能执行交易。

指令处理器是区块链程序如何处理来自客户端的指令的方式。每次交易所涉及的交易所、借贷协议、担保、预言机等都通过指令处理器提供其功能。

## 指令处理器将其状态写入Solana账户

如果您以前进行过Web开发，您可以将指令处理器类比为HTTP路由处理程序，传入指令类比为HTTP请求。

但与HTTP路由处理程序不同，Solana指令处理程序不返回数据。相反，指令处理程序将其数据写入Solana的账户中。

Solana的程序可以转移代币，这些代币最终会出现在用户的钱包地址（对于SOL）以及用户的代币账户（对于其他代币）中。

但更重要的是，Solana的程序可以根据需要创建额外的地址，以存储数据项。

## 程序将数据存储在程序派生地址（PDA）中，这是一个键值存储

Solana程序的数据存储在 **程序派生地址（PDA）** 中。Solana的PDA可以被视为一个 **键/值存储**：

 - '键' 是PDA的地址，由您（程序员）选择的 `seeds` 决定。
   - 想要一个账户来存储从USD到AUD的汇率？您的程序可以使用 `USD` 和 `AUD` 作为 `seeds` 来生成一个程序派生地址。
   - 想要存储两个用户之间关系的信息？您可以使用**这两个用户的钱包地址**作为 `seeds` 来生成一个PDA来存储该信息。
   - 想要一个账户来存储Steve对Titanic的评论？您的程序可以使用Steve的**钱包地址**和字符串 `titanic`（或者您喜欢的IMDB ID）来生成一个程序派生地址。
   - 想要为整个程序存储一些全局信息？您可以使用像 `'config'` 这样的字符串。您的程序的PDA是独一无二的，因此不会与其他程序冲突。
 - 值是给定地址内账户中的数据。
   - PDA内的数据由您（程序员）决定。

键值存储允许您的链上程序和客户端软件始终能够一致地确定数据项的地址，因为相同的 `seeds` 永远会返回相同的地址。

## Solana指令需要指定它们将使用的所有账户

您可能已经知道，Solana之所以快速，是因为它可以同时处理不重叠的交易。即，就像在现实世界中一样，Alice发送给Bob不会阻止Chris向Diana发送东西。您的前端应用程序需要指定它们将使用的所有账户的地址。

这包括您创建的PDA。幸运的是，您可以在在写入数据之前在前端代码中计算PDA的地址！

```typescript
// 此地址目前没有任何内容，但我们将在我们的交易中使用
const address = findProgramAddressSync(
  ['seed', 'another seed'],
  PROGRAM_ID
)
```

## 有多种构建链上程序的方法，但我们推荐Anchor

您目前有两种链上程序开发的选择：

 - 我们建议新的链上程序员[从Anchor开始](./intro-to-anchor)。Anchor的默认设置使创建安全程序变得容易。
 - 本课程还涵盖了[本地链上程序开发](./hello-world-program)。

无论您选择哪种方式，Solana基金会都维护着[两种语言的示例](https://github.com/solana-developers/program-examples)，并且[Solana Stack Exchange](https://solana.stackexchange.com/)可以提供帮助。

现在，让我们[设置您的计算机](./local-setup)！